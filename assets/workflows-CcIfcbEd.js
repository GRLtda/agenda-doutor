import{M as t,K as l,h as c}from"./index-D0Sslu2F.js";const n={getWorkflows(o={}){return t.get("/workflows",{params:o})},getNodeTypes(){return t.get("/workflows/node-types")},getWorkflowById(o){return t.get(`/workflows/${o}`)},createWorkflow(o){return t.post("/workflows",o)},updateWorkflow(o,r){return t.patch(`/workflows/${o}`,r)},activateWorkflow(o){return t.post(`/workflows/${o}/activate`)},deactivateWorkflow(o){return t.post(`/workflows/${o}/deactivate`)},deleteWorkflow(o){return t.delete(`/workflows/${o}`)},createNode(o,r){return t.post(`/workflows/${o}/nodes`,r)},updateNode(o,r){return t.patch(`/workflows/nodes/${o}`,r)},updateNodePosition(o,r){return t.patch(`/workflows/nodes/${o}/position`,r)},deleteNode(o){return t.delete(`/workflows/nodes/${o}`)},createEdge(o,r){return t.post(`/workflows/${o}/edges`,r)},deleteEdge(o){return t.delete(`/workflows/edges/${o}`)},getRuns(o={}){return t.get("/workflows/runs",{params:o})},getRunById(o){return t.get(`/workflows/runs/${o}`)},getRunLogs(o){return t.get(`/workflows/runs/${o}/logs`)},cancelRun(o){return t.post(`/workflows/runs/${o}/cancel`)},triggerWorkflow(o){return t.post("/workflows/trigger",o)}},s=c(),f=l("workflows",{state:()=>({workflows:[],currentWorkflow:null,loading:!1,error:null,nodes:[],edges:[],nodeTypes:[]}),actions:{async fetchWorkflows(o={}){this.loading=!0;try{const r=await n.getWorkflows(o);this.workflows=r.data.workflows}catch(r){this.error=r.message,s.error("Erro ao carregar workflows")}finally{this.loading=!1}},async fetchWorkflowById(o){this.loading=!0,this.currentWorkflow=null,this.nodes=[],this.edges=[];try{const r=await n.getWorkflowById(o);this.currentWorkflow=r.data.workflow,this.nodes=r.data.workflow.nodes||[],this.edges=r.data.workflow.edges||[]}catch(r){this.error=r.message,s.error("Erro ao carregar detalhes do workflow")}finally{this.loading=!1}},async createWorkflow(o){this.loading=!0;try{const r=await n.createWorkflow(o);return this.workflows.push(r.data.workflow),s.success("Workflow criado com sucesso"),r.data.workflow}catch(r){throw s.error("Erro ao criar workflow"),r}finally{this.loading=!1}},async updateWorkflow(o,r){try{const e=await n.updateWorkflow(o,r),a=this.workflows.findIndex(i=>i._id===o);a!==-1&&(this.workflows[a]={...this.workflows[a],...e.data.workflow}),this.currentWorkflow&&this.currentWorkflow._id===o&&(this.currentWorkflow={...this.currentWorkflow,...e.data.workflow}),s.success("Workflow atualizado")}catch{s.error("Erro ao atualizar workflow")}},async activateWorkflow(o){try{const r=await n.activateWorkflow(o);this.currentWorkflow&&this.currentWorkflow._id===o&&(this.currentWorkflow.isActive=!0);const e=this.workflows.findIndex(a=>a._id===o);e!==-1&&(this.workflows[e].isActive=!0),s.success("Workflow ativado")}catch{s.error("Erro ao ativar workflow")}},async deactivateWorkflow(o){try{const r=await n.deactivateWorkflow(o);this.currentWorkflow&&this.currentWorkflow._id===o&&(this.currentWorkflow.isActive=!1);const e=this.workflows.findIndex(a=>a._id===o);e!==-1&&(this.workflows[e].isActive=!1),s.success("Workflow desativado")}catch{s.error("Erro ao desativar workflow")}},async deleteWorkflow(o){try{await n.deleteWorkflow(o),this.workflows=this.workflows.filter(r=>r._id!==o),s.success("Workflow removido")}catch{s.error("Erro ao remover workflow")}},async addNode(o){try{const r={type:o.type,subtype:o.subtype,config:o.config||{},position:o.position},a=(await n.createNode(this.currentWorkflow._id,r)).data.node;return this.nodes.push(a),a}catch(r){throw console.error("Error creating node:",r),s.error("Erro ao adicionar nó"),r}},async updateNodePosition(o,r){const e=this.nodes.find(a=>a._id===o);if(e){e.position=r;try{await n.updateNodePosition(o,r)}catch(a){console.error("Failed to save node position",a)}}},async updateNode(o,r){try{const a=(await n.updateNode(o,r)).data.node,i=this.nodes.findIndex(w=>w._id===o);return i!==-1&&(this.nodes[i]=a),s.success("Nó atualizado com sucesso"),a}catch(e){throw console.error("Error updating node:",e),s.error("Erro ao atualizar nó"),e}},async deleteNode(o){try{await n.deleteNode(o),this.nodes=this.nodes.filter(r=>r._id!==o),s.success("Nó removido com sucesso")}catch(r){throw console.error("Error deleting node:",r),s.error("Erro ao remover nó"),r}},async addEdge(o){this.edges.push(o);try{await n.createEdge(this.currentWorkflow._id,{sourceNodeId:o.source,targetNodeId:o.target})}catch{this.edges=this.edges.filter(e=>e.id!==o.id),s.error("Erro ao conectar nós")}},async removeEdge(o){this.edges=this.edges.filter(r=>r.id!==o);try{await n.deleteEdge(o)}catch{s.error("Erro ao remover conexão")}},async fetchNodeTypes(){try{const o=await n.getNodeTypes();this.nodeTypes=o.data.types}catch(o){console.error("Failed to fetch node types",o)}}}});export{f as u};
